<div class="perfil-container">
  <h2>Perfil de Super Administrador</h2>

  <!-- Mostrar mensaje de carga -->
  <div *ngIf="loading" class="loading">
    <p>Cargando información del perfil...</p>
  </div>

  <!-- Mostrar mensaje de error -->
  <div *ngIf="error" class="error">
    <h3>Error de permisos</h3>
    <pre>{{ error }}</pre>
    <button (click)="loadProfile()" class="btn-reintentar">Reintentar</button>
  </div>

  <!-- Mostrar información del perfil -->
  <div *ngIf="perfil && !loading" class="perfil-card">
    <div class="perfil-header">
      <h3>Información Personal</h3>
    </div>

    <!-- Modo de visualización -->
    <div *ngIf="!editMode && !showPasswordChange" class="perfil-info">
      <div class="info-item">
        <label>Nombre Completo:</label>
        <div class="input-container">
          <input
            *ngIf="editingField === 'nombreCompleto'"
            type="text"
            [(ngModel)]="updateData.nombreCompleto"
            placeholder="Nombre completo"
          />
          <span *ngIf="editingField !== 'nombreCompleto'">{{ perfil.nombreCompleto }}</span>
          <button
            *ngIf="editingField !== 'nombreCompleto'"
            (click)="toggleFieldEdit('nombreCompleto')"
            class="btn-edit-icon"
            title="Editar"
          >
            ✏️
          </button>
          <div *ngIf="editingField === 'nombreCompleto'" class="edit-actions">
            <button (click)="saveField('nombreCompleto')" class="btn-save-icon" title="Guardar">
              ✓
            </button>
            <button (click)="toggleFieldEdit('nombreCompleto')" class="btn-cancel-icon" title="Cancelar">
              ✕
            </button>
          </div>
        </div>
      </div>

      <div class="info-item">
        <label>Email:</label>
        <div class="input-container">
          <input
            *ngIf="editingField === 'email'"
            type="email"
            [(ngModel)]="updateData.email"
            placeholder="Email"
          />
          <span *ngIf="editingField !== 'email'">{{ perfil.email }}</span>
          <button
            *ngIf="editingField !== 'email'"
            (click)="toggleFieldEdit('email')"
            class="btn-edit-icon"
            title="Editar"
          >
            ✏️
          </button>
          <div *ngIf="editingField === 'email'" class="edit-actions">
            <button (click)="saveField('email')" class="btn-save-icon" title="Guardar">
              ✓
            </button>
            <button (click)="toggleFieldEdit('email')" class="btn-cancel-icon" title="Cancelar">
              ✕
            </button>
          </div>
        </div>
      </div>

      <div class="info-item">
        <label>Teléfono:</label>
        <div class="input-container">
          <input
            *ngIf="editingField === 'telefono'"
            type="text"
            [(ngModel)]="updateData.telefono"
            placeholder="Teléfono"
          />
          <span *ngIf="editingField !== 'telefono'">{{ perfil.telefono || 'No proporcionado' }}</span>
          <button
            *ngIf="editingField !== 'telefono'"
            (click)="toggleFieldEdit('telefono')"
            class="btn-edit-icon"
            title="Editar"
          >
            ✏️
          </button>
          <div *ngIf="editingField === 'telefono'" class="edit-actions">
            <button (click)="saveField('telefono')" class="btn-save-icon" title="Guardar">
              ✓
            </button>
            <button (click)="toggleFieldEdit('telefono')" class="btn-cancel-icon" title="Cancelar">
              ✕
            </button>
          </div>
        </div>
      </div>

      <div class="info-item">
        <label>Documento:</label>
        <div class="input-container">
          <input
            *ngIf="editingField === 'documento'"
            type="text"
            [(ngModel)]="updateData.documento"
            placeholder="Documento"
          />
          <span *ngIf="editingField !== 'documento'">{{ perfil.documento || 'No proporcionado' }}</span>
          <button
            *ngIf="editingField !== 'documento'"
            (click)="toggleFieldEdit('documento')"
            class="btn-edit-icon"
            title="Editar"
          >
            ✏️
          </button>
          <div *ngIf="editingField === 'documento'" class="edit-actions">
            <button (click)="saveField('documento')" class="btn-save-icon" title="Guardar">
              ✓
            </button>
            <button (click)="toggleFieldEdit('documento')" class="btn-cancel-icon" title="Cancelar">
              ✕
            </button>
          </div>
        </div>
      </div>

      <div class="info-item">
        <label>Rol:</label>
        <span>{{ perfil.rol }}</span>
      </div>

      <div class="info-item">
        <label>Fecha de Registro:</label>
        <span>{{ perfil.fechaRegistro | date : 'dd/MM/yyyy' }}</span>
      </div>

      <!-- Mostrar rol del token si es diferente al rol del perfil -->
      <div class="info-item" *ngIf="userRole && userRole !== perfil.rol">
        <label>Rol de Token:</label>
        <span>{{ userRole }}</span>
      </div>
    </div>

    <!-- Formulario de cambio de contraseña -->
    <div *ngIf="showPasswordChange" class="password-change-form">
      <h4>Cambiar Contraseña</h4>
      <div class="form-group">
        <label for="contrasena">Nueva Contraseña:</label>
        <input
          type="password"
          id="contrasena"
          [(ngModel)]="updateData.contrasena"
          placeholder="Nueva contraseña"
        />
      </div>
      <div class="password-actions">
        <button (click)="updatePassword()" class="btn-guardar">Guardar Contraseña</button>
        <button (click)="togglePasswordChange()" class="btn-cancelar">Cancelar</button>
      </div>
    </div>

    <div class="perfil-actions">
      <button (click)="togglePasswordChange()" class="btn-password">
        {{ showPasswordChange ? 'Cancelar Cambio de Contraseña' : 'Cambiar Contraseña' }}
      </button>
      <button (click)="onDeleteAccount()" class="btn-eliminar">Eliminar Cuenta</button>
    </div>
  </div>

  <!-- Mostrar mensaje si no hay perfil y no hay error -->
  <div *ngIf="!perfil && !loading && !error" class="no-data">
    <p>No se encontró información de perfil.</p>
    <p *ngIf="userRole">Su rol actual es: {{ userRole }}</p>
    <div *ngIf="tokenInfo" class="token-info">
      <h4>Información del Token:</h4>
      <p>Roles: {{ tokenInfo.roles ? tokenInfo.roles.join(', ') : 'No identificados' }}</p>
    </div>
  </div>
</div>
