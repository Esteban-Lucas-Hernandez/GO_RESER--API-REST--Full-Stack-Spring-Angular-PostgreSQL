<div class="habitaciones-container">
  <h1>Habitaciones del Hotel</h1>

  <!-- Botón para volver al listado de hoteles -->
  <div class="volver-container">
    <button class="btn-volver" (click)="volverAlListado()">← Volver al Listado de Hoteles</button>
  </div>

  <!-- Información del hotel -->
  <div class="hotel-info-section" *ngIf="hotel && !loading && !error">
    <h2>{{ hotel.nombre }}</h2>

    <div class="hotel-details-grid">
      <div class="hotel-detail-item">
        <strong>Email:</strong>
        <span>{{ hotel.email }}</span>
      </div>

      <div class="hotel-detail-item">
        <strong>Descripción:</strong>
        <span>{{ hotel.descripcion }}</span>
      </div>

      <div class="hotel-detail-item">
        <strong>Check-in:</strong>
        <span>{{ hotel.checkIn }}</span>
      </div>

      <div class="hotel-detail-item">
        <strong>Check-out:</strong>
        <span>{{ hotel.checkOut }}</span>
      </div>

      <div class="hotel-detail-item">
        <strong>Creado:</strong>
        <span>{{ hotel.createdAt | date : 'dd/MM/yyyy HH:mm' }}</span>
      </div>

      <div class="hotel-detail-item">
        <strong>Actualizado:</strong>
        <span>{{ hotel.updatedAt | date : 'dd/MM/yyyy HH:mm' }}</span>
      </div>
    </div>
  </div>

  <!-- Contenedor del mapa -->
  <div class="map-container">
    <h2>Ubicación del Hotel</h2>
    <div id="map" class="map"></div>
  </div>

  <!-- Mensaje de carga -->
  <div *ngIf="loading" class="loading">Cargando habitaciones...</div>

  <!-- Mensaje de error -->
  <div *ngIf="error" class="error">
    {{ error }}
  </div>

  <!-- Lista de habitaciones -->
  <div *ngIf="!loading && !error" class="habitaciones-list">
    <div *ngIf="habitaciones.length === 0" class="no-habitaciones">
      No se encontraron habitaciones.
    </div>

    <div *ngFor="let habitacion of habitaciones" class="habitacion-card">
      <!-- Imagen de la habitación -->
      <div class="habitacion-image" *ngIf="habitacion.imagenUrl">
        <img [src]="habitacion.imagenUrl" [alt]="'Habitación ' + habitacion.numero" />
      </div>
      <div class="habitacion-image placeholder" *ngIf="!habitacion.imagenUrl">
        <div class="image-placeholder">Imagen no disponible</div>
      </div>

      <!-- Información de la habitación -->
      <div class="habitacion-info">
        <h3>Habitación {{ habitacion.numero }}</h3>

        <div class="habitacion-details">
          <p><strong>Categoría:</strong> {{ habitacion.categoria.nombre }}</p>
          <p><strong>Capacidad:</strong> {{ habitacion.capacidad }} personas</p>
          <p><strong>Estado:</strong> {{ habitacion.estado }}</p>
        </div>

        <!-- Botón para ver detalles -->
        <div class="habitacion-actions">
          <button class="btn-ver-detalles" (click)="verDetalles(habitacion.idHabitacion)">
            Ver Detalles
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Apartado de reseñas -->
  <div class="resenas-section" *ngIf="!loading && !error">
    <div class="resenas-header">
      <h2>Reseñas del Hotel</h2>
      <!-- Botón para añadir reseña -->
      <button class="btn-anadir-resena" (click)="openCreateModal()">Añadir Reseña</button>
    </div>

    <div *ngIf="resenas.length === 0" class="no-resenas">
      No hay reseñas para este hotel todavía.
    </div>

    <div *ngFor="let resena of resenas" class="resena-card">
      <div class="resena-header">
        <!-- Mostrar la imagen de perfil del usuario -->
        <div class="resena-usuario-info">
          <div class="resena-usuario-avatar" *ngIf="resena.fotoUrl">
            <img
              [src]="resena.fotoUrl"
              [alt]="'Foto de ' + resena.nombreUsuario"
              class="avatar-image"
            />
          </div>
          <div class="resena-usuario-avatar placeholder" *ngIf="!resena.fotoUrl">
            <img
              src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png"
              [alt]="'Foto de ' + resena.nombreUsuario"
              class="avatar-image"
            />
          </div>
          <span class="resena-usuario">{{ resena.nombreUsuario }}</span>
        </div>
        <div class="resena-calificacion">
          <span
            *ngFor="
              let star of [].constructor(getValidCalificacion(resena.calificacion));
              let i = index
            "
            class="star filled"
            >★</span
          >
          <span
            *ngFor="let star of [].constructor(getEmptyStars(resena.calificacion)); let i = index"
            class="star"
            >★</span
          >
        </div>
      </div>
      <p class="resena-comentario">{{ resena.comentario }}</p>
      <span class="resena-fecha">{{ resena.fechaResena }}</span>

      <!-- Botones de acción para reseñas del usuario -->
      <div class="resena-actions" *ngIf="isUserReview(resena)">
        <button class="btn-editar" (click)="editarResena(resena)">Editar</button>
        <button class="btn-eliminar" (click)="deleteResena(resena.idResena)">Eliminar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Edición de Reseña -->
<div class="modal" *ngIf="showEditModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Editar Reseña</h3>
      <span class="close" (click)="closeEditModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="saveResenaChanges()" #editForm="ngForm">
        <div class="form-group">
          <label for="calificacion">Calificación:</label>
          <div class="rating-input">
            <span
              *ngFor="let star of [].constructor(5); let i = index"
              class="star"
              [class.filled]="i < editCalificacion"
              (click)="editCalificacion = i + 1"
              >★</span
            >
          </div>
        </div>

        <div class="form-group">
          <label for="comentario">Comentario:</label>
          <textarea
            id="comentario"
            [(ngModel)]="editComentario"
            name="comentario"
            rows="4"
            required
            class="form-control"
          ></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancelar" (click)="closeEditModal()">Cancelar</button>
          <button type="submit" class="btn-guardar" [disabled]="!editForm.form.valid">
            Guardar Cambios
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal de Creación de Reseña -->
<div class="modal" *ngIf="showCreateModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Añadir Reseña</h3>
      <span class="close" (click)="closeCreateModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="saveNewResena()" #createForm="ngForm">
        <div class="form-group">
          <label for="newCalificacion">Calificación:</label>
          <div class="rating-input">
            <span
              *ngFor="let star of [].constructor(5); let i = index"
              class="star"
              [class.filled]="i < newCalificacion"
              (click)="newCalificacion = i + 1"
              >★</span
            >
          </div>
        </div>

        <div class="form-group">
          <label for="newComentario">Comentario:</label>
          <textarea
            id="newComentario"
            [(ngModel)]="newComentario"
            name="newComentario"
            rows="4"
            required
            class="form-control"
          ></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancelar" (click)="closeCreateModal()">Cancelar</button>
          <button type="submit" class="btn-guardar" [disabled]="!createForm.form.valid">
            Añadir Reseña
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
